
load('nashorn:mozilla_compat.js');
importPackage(java.lang);
importPackage(Packages.util);
importPackage(Packages.client.inventory);
importPackage(Packages.server);
var status;

var icon1 = "#fEffect/ItemEff/004/0#"; //黃驚嘆
var icon5 = "#fEffect/ItemEff/0/10#";
var icon2 = "#fUI/UIWindow/Quest/icon1#"; //灰驚嘆
var icon3 = "#fEffect/ItemEff/004/1#";
var icon4 = "#fUI/UIWindow/Quest/icon7/8#"; //限時
var cake = "#fEffect/ItemEff/0/9#";
var get = "#fEffect/ItemEff/004/3#";
var need = "#fEffect/ItemEff/004/4#";



var topic = "暖陽兌換";

var pack = [

   [
      [4470010,1],
	  [4001246,200],
   ],
   
   [
      [2300001,1000],
	  [4001246,100],
   ],
   
   [
      [4470001,1],
	  [4001246,100],
   ],
   
   [
      [4470011,1],
	  [4001246,200],
   ],
   
   [
      [2431965,1],
	  [4001246,200],
   ],
   
   [
      [2430144,1],
	  [4001246,200],
   ],
   
   [
      [5220082,1],
	  [4001246,200],
   ],
   
   [
      [1005582,1],
	  [4001246,8000],
   ],
   
   [
      [1132321,1],
	  [4001246,8000],
   ],
   
   [
      [4470008,1],
	  [4001246,100],
   ],
   
   [
      [4470009,1],
	  [4001246,100],
   ],
   
   [
      [2049400,1],
	  [4001246,100],
   ],
   
   [
      [2340000,1],
	  [4001246,50],
   ],
   
   [
      [2049100,1],
	  [4001246,50],
   ],
   
   
   [
      [2040004,1],
	  [4001246,50],
   ],
   
   [
      [2040017,1],
	  [4001246,50],
   ],
   
   [
      [2040025,1],
	  [4001246,50],
   ],
   
   [
      [2040029,1],
	  [4001246,50],
   ],
   
   [
      [2040106,1],
	  [4001246,50],
   ],
   
   [
      [2040201,1],
	  [4001246,50],
   ],
   
   [
      [2040206,1],
	  [4001246,50],
   ],
   
   [
      [2040233,1],
	  [4001246,50],
   ],
   
   [
      [2040234,1],
	  [4001246,50],
   ],
   
   [
      [2040235,1],
	  [4001246,50],
   ],
   
   [
      [2040236,1],
	  [4001246,50],
   ],
   
   [
      [2040301,1],
	  [4001246,50],
   ],
   
   [
      [2040311,1],
	  [4001246,50],
   ],
   
   [
      [2040317,1],
	  [4001246,50],
   ],
   
   [
      [2040321,1],
	  [4001246,50],
   ],
   
   [
      [2040326,1],
	  [4001246,50],
   ],
   
   [
      [2040401,1],
	  [4001246,50],
   ],
   
   [
      [2040413,1],
	  [4001246,50],
   ],
   
   [
      [2040418,1],
	  [4001246,50],
   ],
   
   [
      [2040421,1],
	  [4001246,50],
   ],
   
   [
      [2040425,1],
	  [4001246,50],
   ],
   
   [
      [2040501,1],
	  [4001246,50],
   ],
   
   [
      [2040504,1],
	  [4001246,50],
   ],
   
   [
      [2040513,1],
	  [4001246,50],
   ],
   
   [
      [2040516,1],
	  [4001246,50],
   ],
   
   [
      [2040532,1],
	  [4001246,50],
   ],
   
   [
      [2040601,1],
	  [4001246,50],
   ],
   
   [
      [2040613,1],
	  [4001246,50],
   ],
   
   [
      [2040618,1],
	  [4001246,50],
   ],
   
   [
      [2040621,1],
	  [4001246,50],
   ],
   
   [
      [2040625,1],
	  [4001246,50],
   ],
   
   [
      [2040701,1],
	  [4001246,50],
   ],
   
   [
      [2040704,1],
	  [4001246,50],
   ],
   
   [
      [2040707,1],
	  [4001246,50],
   ],
   
   [
      [2040801,1],
	  [4001246,50],
   ],
   
   [
      [2040804,1],
	  [4001246,50],
   ],
   
   [
      [2040817,1],
	  [4001246,50],
   ],
   
   [
      [2040824,1],
	  [4001246,50],
   ],
   
   [
      [2040826,1],
	  [4001246,50],
   ],
   
   [
      [2040845,1],
	  [4001246,50],
   ],
   
   [
      [2040901,1],
	  [4001246,50],
   ],
   
   [
      [2040914,1],
	  [4001246,50],
   ],
   
   [
      [2040919,1],
	  [4001246,50],
   ],
   
   [
      [2040924,1],
	  [4001246,50],
   ],
   
   [
      [2040927,1],
	  [4001246,50],
   ],
   
   [
      [2040931,1],
	  [4001246,50],
   ],
   
   [
      [2041010,1],
	  [4001246,50],
   ],
   
   [
      [2041013,1],
	  [4001246,50],
   ],

   [
      [2041016,1],
	  [4001246,50],
   ],

   [
      [2041019,1],
	  [4001246,50],
   ],

   [
      [2041022,1],
	  [4001246,50],
   ],   
   
   [
      [2041101,1],
	  [4001246,50],
   ],   
   
   [
      [2041104,1],
	  [4001246,50],
   ], 
   
   [
      [2041107,1],
	  [4001246,50],
   ], 
   
   [
      [2041110,1],
	  [4001246,50],
   ], 
   
   [
      [2041202,1],
	  [4001246,50],
   ], 
   
   [
      [2041207,1],
	  [4001246,50],
   ], 
   
   [
      [2041301,1],
	  [4001246,50],
   ], 
   
   [
      [2041304,1],
	  [4001246,50],
   ], 
   
   [
      [2041307,1],
	  [4001246,50],
   ], 
   
   [
      [2041310,1],
	  [4001246,50],
   ], 
   
   [
      [2043001,1],
	  [4001246,50],
   ], 
   
   [
      [2043009,1],
	  [4001246,50],
   ], 
   
   [
      [2043101,1],
	  [4001246,50],
   ], 
   
   [
      [2043201,1],
	  [4001246,50],
   ], 
   
   [
      [2043301,1],
	  [4001246,50],
   ], 
   
   [
      [2043401,1],
	  [4001246,50],
   ], 
   
   [
      [2043701,1],
	  [4001246,50],
   ], 
   
   [
      [2043801,1],
	  [4001246,50],
   ], 
   
   [
      [2044001,1],
	  [4001246,50],
   ], 
   
   [
      [2044101,1],
	  [4001246,50],
   ], 
   
   [
      [2044201,1],
	  [4001246,50],
   ], 
   
   [
      [2044301,1],
	  [4001246,50],
   ], 
   
   [
      [2044401,1],
	  [4001246,50],
   ], 
   
   [
      [2044501,1],
	  [4001246,50],
   ], 
   
   [
      [2044601,1],
	  [4001246,50],
   ], 
   
   [
      [2044701,1],
	  [4001246,50],
   ], 
   
   [
      [2044801,1],
	  [4001246,50],
   ], 
   
   [
      [2044901,1],
	  [4001246,50],
   ], 
   
   [
      [2045201,1],
	  [4001246,50],
   ], 
   
   [
      [2045301,1],
	  [4001246,50],
   ], 
];



function start(){
	status = -1;
	action(1,0,0);
}




function action(mode, type, selection) {
    if (mode == 1) {
        status++;
    } else {
        status--;
    }
	if(mode == 0){
		cm.dispose();
	}
	
    if (status == 0) {
		var msg =  "                   " + icon5 + " #d#e【" + topic + "】#n#k \r\n\r\n";
		msg += "   " + cake + "" + cake + "" + cake + "" + cake + "" + cake + "" + cake + "" + cake + "" + cake + "" + cake + "" + cake + "" + cake + "" + cake + "" + cake + "" + cake+ "" + cake + "" + cake + "" + cake + "" + cake +  "  \r\n";
		for(var a = 0 ; a < pack.length ; a++){
			msg += "#L" + a + "#"+icon3+" #b《兌換 #k#r#e#z" + pack[a][0][0] + "##n#k#b》#k#l\r\n";
		}
		cm.sendSimple(msg + " \r\n ");
	}else if(status == 1){
		this. sel = selection;
		if(sel == -1){
			cm.dispose();
	    }else{
		    var memo = icon5 + " #e#b【此兌換詳細需要內容物為】 :#k#n\r\n\r\n";
		    var needs = "";
		    for(var b = 1 ; b < pack[sel].length ; b++) {
			    needs += need + " #e#i" + pack[sel][b][0] + " # #z" + pack[sel][b][0] + "# 共 : #r" + pack[sel][b][1] + " 個#k#n\r\n";
		    }
		    memo += needs;
		
		    memo += get + " #e#r可兌換  : #k#d#i" + pack[sel][0][0] + "# #z" + pack[sel][0][0] + "##k 共 : #r" + pack[sel][0][1] + " 個#k#n"; 

		
		    cm.sendYesNo(memo);
		}
	}else if(status == 2){
		cm.sendGetNumber("#d請輸入想兌換的組數 :#k",0,0,9999);
	}else if(status == 3){
		var xx = selection;
		var checkitems = 1;
		var notice = icon5 + " #b您欲兌換#k #r#i" + pack[sel][0][0] + " # #z" + pack[sel][0][0] + "##k #b出現以下錯誤 ：\r\n";
		for(var cc = 1 ; cc < pack[sel].length ; cc ++){
			if(!cm.haveItem(pack[sel][cc][0],pack[sel][cc][1]*xx)){
				checkitems ++;
				notice += icon1 + " #b缺少材料#k :#i" + pack[sel][cc][0] + "# #z" + pack[sel][cc][0] + "# 共 #r " + pack[sel][cc][1]*xx + "個#k\r\n";
			}
			
			if(pack[sel][cc][1]*xx >= 30000){
				checkitems ++;
				notice += icon1 + " #b材料#k :#i" + pack[sel][cc][0] + "# #z" + pack[sel][cc][0] + "# #r總需求不得高於30000#k\r\n";
			}
		}
		
		if(checkitems > 1){
			cm.sendOk(notice);
			status = -1;
		}else {
			cm.getPlayer().gainItem(pack[sel][0][0],pack[sel][0][1]*xx);
			for(var c = 1 ; c < pack[sel].length ; c++){
				cm.gainItem(pack[sel][c][0],-pack[sel][c][1]*xx);
			}
			
			cm.sendOk("謝謝您的兌換!");
			status = -1;
		}
    }
}

		